<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battleship - Online Multiplayer</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* Matchmaking Screen */
        #matchmakingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        .matchmaking-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4FC3F7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #81D4FA;
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #B3E5FC;
        }

        .player-info-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #playerIdDisplay {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 1.1rem;
            word-break: break-all;
            color: #4FC3F7;
        }

        /* Matchmaking Options Container */
        .matchmaking-options {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .option-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(79, 195, 247, 0.3);
            transform: translateY(-5px);
        }

        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .option-description {
            margin: 15px 0;
            color: #B3E5FC;
            font-size: 0.9rem;
        }

        /* Join Room Form */
        #joinRoomForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .room-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            text-align: center;
            letter-spacing: 2px;
            font-family: monospace;
        }

        .room-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .room-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.3);
        }

        .info-text {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #81D4FA;
        }

        /* Room Actions */
        .room-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .room-btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
            font-weight: bold;
        }

        .room-btn-primary {
            background: linear-gradient(45deg, #00C853, #64DD17);
            color: white;
        }

        .room-btn-secondary {
            background: linear-gradient(45deg, #FF3D00, #FF9100);
            color: white;
        }

        .room-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Searching Animation */
        .searching-dots {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .searching-dots .dot {
            width: 20px;
            height: 20px;
            background: #00E676;
            border-radius: 50%;
            animation: searching 1.4s infinite;
        }

        .searching-dots .dot:nth-child(2) { animation-delay: 0.2s; }
        .searching-dots .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes searching {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-15px); opacity: 1; }
        }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
            min-width: 200px;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00C853, #64DD17);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 200, 83, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 200, 83, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #FF3D00, #FF9100);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 61, 0, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 61, 0, 0.6);
        }

        /* Room Status */
        .room-creator {
            background: rgba(0, 230, 118, 0.2);
            border: 2px solid #00E676;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 230, 118, 0.5); }
            50% { box-shadow: 0 0 40px rgba(0, 230, 118, 0.8); }
        }

        #roomId {
            font-size: 2rem;
            font-weight: bold;
            color: #00E676;
            margin: 10px 0;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            display: inline-block;
        }

        .room-id-display {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        #countdown {
            font-size: 4rem;
            font-weight: bold;
            color: #FFEA00;
            animation: countdownPulse 1s infinite;
            display: inline-block;
            margin: 0 10px;
        }

        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Error Messages */
        .error-message {
            background: rgba(255, 61, 0, 0.2);
            border: 1px solid #FF3D00;
            color: #FFCDD2;
            padding: 12px 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        /* Game Screen */
        #gameScreen {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 2px solid rgba(79, 195, 247, 0.3);
        }

        .game-title {
            font-size: 2.5rem;
            color: #4FC3F7;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        #turnIndicator {
            font-size: 1.8rem;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
            background: linear-gradient(45deg, #FF9800, #FF5722);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        .player-info-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            min-width: 200px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .player-card h3 {
            color: #81D4FA;
            margin-bottom: 10px;
        }

        .player-card p {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4FC3F7;
        }

        /* Game Grids */
        .game-grids {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .grid-section {
            text-align: center;
        }

        .grid-section h3 {
            margin-bottom: 15px;
            color: #B3E5FC;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #4FC3F7;
            border-radius: 5px;
            padding: 5px;
        }

        @media (max-width: 900px) {
            .grid {
                width: 320px;
                height: 320px;
            }
        }

        @media (max-width: 700px) {
            .grid {
                width: 280px;
                height: 280px;
            }
        }

        .cell {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            position: relative;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .cell.ship {
            background: rgba(41, 121, 255, 0.5);
            border-color: #2979FF;
        }

        .cell.hit {
            background: #FF3D00;
            animation: hitAnimation 0.5s;
        }

        .cell.hit::after {
            content: "üí•";
            font-size: 1.2rem;
        }

        .cell.miss {
            background: rgba(255, 255, 255, 0.3);
        }

        .cell.miss::after {
            content: "‚óã";
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        .cell.placement-hover {
            background: rgba(79, 195, 247, 0.3);
            border: 2px dashed #4FC3F7;
        }

        .cell.invalid-placement {
            background: rgba(255, 61, 0, 0.3);
            border: 2px dashed #FF3D00;
        }

        @keyframes hitAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Ship Selection */
        .ship-selection-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }

        .ship-item {
            padding: 15px 20px;
            background: rgba(41, 121, 255, 0.3);
            border: 2px solid #2979FF;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-width: 150px;
        }

        .ship-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(41, 121, 255, 0.4);
        }

        .ship-item.selected {
            background: rgba(79, 195, 247, 0.5);
            border-color: #4FC3F7;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(79, 195, 247, 0.6);
        }

        .ship-item.placed {
            background: rgba(0, 230, 118, 0.3);
            border-color: #00E676;
            cursor: default;
            opacity: 0.7;
        }

        /* Game Controls */
        .game-controls {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 2px solid rgba(255, 61, 0, 0.3);
        }

        .controls-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Ship Status */
        .ship-status-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(0, 230, 118, 0.3);
        }

        .ship-status-container h3 {
            text-align: center;
            margin-bottom: 15px;
        }

        .ship-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .ship-status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .ship-status-item.sunk {
            background: rgba(255, 61, 0, 0.3);
            text-decoration: line-through;
            opacity: 0.7;
        }

        /* Chat System */
        .chat-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid #4FC3F7;
        }

        .message.system {
            border-left-color: #00E676;
            font-style: italic;
        }

        .message.player {
            border-left-color: #FF9100;
        }

        .message.opponent {
            border-left-color: #FF3D00;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        #chatInput {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        #chatInput:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        /* Game Over Overlay */
        #gameOverOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .game-over-content {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: gameOverEnter 0.5s;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
        }

        @keyframes gameOverEnter {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-5deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        #gameOverTitle {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #FFEA00;
            text-shadow: 0 0 20px rgba(255, 234, 0, 0.5);
        }

        #gameOverMessage {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: white;
        }

        .game-over-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Hidden Class */
        .hidden {
            display: none !important;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .matchmaking-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .btn {
                min-width: 160px;
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .option-card {
                padding: 20px;
            }
            
            .room-id-display {
                flex-direction: column;
                gap: 10px;
            }
            
            .grid-section h3 {
                font-size: 1.2rem;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            #turnIndicator {
                font-size: 1.3rem;
                padding: 10px 20px;
            }
            
            .ship-item {
                min-width: 120px;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            .matchmaking-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .grid {
                width: 250px;
                height: 250px;
            }
            
            .game-over-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .game-over-buttons .btn {
                width: 100%;
                max-width: 200px;
            }
            
            .room-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .room-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
    <!-- Back4App Parse SDK -->
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
</head>
<body>
    <!-- Matchmaking Screen -->
    <div id="matchmakingScreen">
        <div class="matchmaking-container">
            <h1>üö¢ BATTLESHIP ONLINE</h1>
            
            <!-- Player Info -->
            <div class="player-info-card">
                <h3>YOUR PLAYER ID</h3>
                <p id="playerIdDisplay">Loading...</p>
            </div>
            
            <!-- Matchmaking Status -->
            <h2 id="matchmakingStatus">CHOOSE GAME MODE</h2>
            
            <!-- Error Message -->
            <div class="error-message" id="errorMessage">
                <span id="errorText"></span>
            </div>
            
            <!-- Searching Animation -->
            <div class="searching-dots hidden" id="searchingDots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            
            <!-- Matchmaking Options -->
            <div class="matchmaking-options" id="matchmakingOptions">
                <!-- Quick Match Option -->
                <div class="option-card">
                    <div class="option-icon">‚ö°</div>
                    <h3>QUICK MATCH</h3>
                    <p class="option-description">
                        Find a random opponent instantly. Perfect for quick battles!
                    </p>
                    <button class="btn btn-primary" onclick="startQuickMatch()">
                        FIND MATCH
                    </button>
                </div>
                
                <!-- Join Room Option -->
                <div class="option-card">
                    <div class="option-icon">üîë</div>
                    <h3>JOIN ROOM</h3>
                    <p class="option-description">
                        Enter a room ID to join a specific game with friends
                    </p>
                    <div id="joinRoomForm">
                        <div class="input-group">
                            <input type="text" class="room-input" id="roomCodeInput" 
                                   placeholder="ENTER ROOM CODE" maxlength="6"
                                   oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="room-actions">
                            <button class="room-btn room-btn-primary" onclick="joinRoom()">
                                JOIN ROOM
                            </button>
                            <button class="room-btn room-btn-secondary" onclick="generateRoom()">
                                CREATE ROOM
                            </button>
                        </div>
                        <p class="info-text">
                            Room codes are 6 characters (A-Z, 0-9)
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Room Created Status -->
            <div id="roomStatus" class="hidden">
                <div class="room-creator">
                    <h3>üéÆ ROOM CREATED!</h3>
                    <p>Share this Room ID with your friend:</p>
                    <div class="room-id-display">
                        <div id="roomId">ABC123</div>
                        <button class="copy-btn" onclick="copyRoomId()">
                            üìã COPY
                        </button>
                    </div>
                    <p>Waiting for opponent to join...</p>
                    <div class="searching-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </div>
            
            <!-- Queue Status -->
            <div id="queueStatus" class="hidden">
                <div class="room-creator">
                    <h3>üîç SEARCHING FOR OPPONENT...</h3>
                    <p>Looking for another player to battle</p>
                    <div class="searching-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </div>
            
            <!-- Opponent Found Status -->
            <div id="foundOpponent" class="hidden">
                <h3>üéÆ OPPONENT FOUND!</h3>
                <p>Starting game in <span id="countdown">3</span></p>
                <div class="room-creator">
                    <p>Playing against: <span id="opponentNameDisplay">Opponent</span></p>
                </div>
            </div>
            
            <!-- Control Buttons -->
            <div class="controls-row" id="matchmakingControls">
                <button class="btn btn-secondary" onclick="cancelMatchmaking()" id="cancelBtn" class="hidden">
                    ‚ùå CANCEL
                </button>
                <button class="btn btn-secondary" onclick="exitToMenu()">
                    üè† MAIN MENU
                </button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen">
        <!-- Game Header -->
        <div class="game-header">
            <h1 class="game-title">üö¢ NAVAL BATTLE</h1>
            <div id="turnIndicator">PLACE YOUR SHIPS (0/5)</div>
        </div>

        <!-- Player Info -->
        <div class="player-info-container">
            <div class="player-card">
                <h3>YOU</h3>
                <p id="playerName">Player 1</p>
            </div>
            <div class="player-card">
                <h3>STATUS</h3>
                <p style="color: #00E676;" id="playerStatus">PLACING SHIPS</p>
            </div>
            <div class="player-card">
                <h3>OPPONENT</h3>
                <p id="opponentName">Waiting...</p>
            </div>
        </div>

        <!-- Game Grids -->
        <div class="game-grids">
            <!-- Player's Fleet Grid -->
            <div class="grid-section">
                <h3>YOUR FLEET</h3>
                <div class="grid" id="playerGrid"></div>
                <p style="margin-top: 10px; color: #81D4FA;">
                    <small>Select a ship below, then click to place it</small>
                </p>
            </div>

            <!-- Attack Grid -->
            <div class="grid-section">
                <h3>ATTACK ZONE</h3>
                <div class="grid" id="attackGrid"></div>
                <p style="margin-top: 10px; color: #81D4FA;">
                    <small>Click to attack during battle phase</small>
                </p>
            </div>
        </div>

        <!-- Ship Selection -->
        <div class="ship-status-container">
            <h3 id="shipStatusTitle">SELECT A SHIP TO PLACE</h3>
            <div class="ship-selection-container" id="shipSelection">
                <!-- Ships will be dynamically inserted here -->
            </div>
            <p style="text-align: center; margin-top: 15px; color: #81D4FA;">
                Click a ship to select it, then click on your grid to place it
            </p>
        </div>

        <!-- Game Controls -->
        <div class="game-controls">
            <h3>GAME CONTROLS</h3>
            <div class="controls-row">
                <button class="btn btn-secondary" onclick="surrenderGame()">
                    üè≥Ô∏è SURRENDER
                </button>
                <button class="btn btn-secondary" onclick="exitGame()">
                    üö™ LEAVE GAME
                </button>
                <button class="btn btn-primary" onclick="toggleOrientation()" id="orientationBtn">
                    üîÑ VERTICAL
                </button>
                <button class="btn btn-primary" onclick="autoPlaceShips()" id="autoPlaceBtn">
                    ü§ñ AUTO PLACE ALL
                </button>
            </div>
        </div>

        <!-- Chat System -->
        <div class="chat-container">
            <div class="chat-header">
                <h3>üí¨ BATTLE CHAT</h3>
                <div style="color: #81D4FA;">Online</div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message system">
                    <strong>System:</strong> Welcome to Battleship! Place your ships to begin.
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Type your message here..." 
                       onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div id="gameOverOverlay" class="hidden">
        <div class="game-over-content">
            <h1 id="gameOverTitle">VICTORY!</h1>
            <p id="gameOverMessage">Congratulations! You have won the battle!</p>
            <div class="game-over-buttons">
                <button class="btn btn-primary" onclick="rematch()" id="rematchBtn">
                    PLAY AGAIN
                </button>
                <button class="btn btn-secondary" onclick="goToMenu()" id="menuBtn">
                    MAIN MENU
                </button>
            </div>
        </div>
    </div>

    <!-- Simplified Game Logic -->
    <script>
        // Global game state
        const gameState = {
            playerId: null,
            playerName: "Player",
            gameId: null,
            playerNumber: 1,
            opponentName: "Opponent",
            gamePhase: "placement", // "placement" or "battle"
            currentTurn: 1,
            placedShips: 0,
            orientation: "vertical",
            selectedShip: null,
            ships: [],
            attacks: [],
            shipTypes: [
                { name: "Carrier", size: 5, id: "carrier", placed: false },
                { name: "Battleship", size: 4, id: "battleship", placed: false },
                { name: "Cruiser", size: 3, id: "cruiser", placed: false },
                { name: "Submarine", size: 3, id: "submarine", placed: false },
                { name: "Destroyer", size: 2, id: "destroyer", placed: false }
            ]
        };

        // Initialize the game
        function initializeGame() {
            console.log("Initializing game...");
            
            // Generate player ID
            gameState.playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
            
            // Get player name from localStorage or generate
            const savedName = localStorage.getItem('battleship_playerName');
            if (savedName) {
                gameState.playerName = savedName;
            } else {
                const names = ["Captain", "Admiral", "Commander", "Sailor", "Pirate"];
                const randomName = names[Math.floor(Math.random() * names.length)];
                gameState.playerName = `${randomName}_${Math.floor(Math.random() * 1000)}`;
                localStorage.setItem('battleship_playerName', gameState.playerName);
            }
            
            // Update UI
            document.getElementById('playerIdDisplay').textContent = gameState.playerId;
            document.getElementById('playerName').textContent = gameState.playerName;
            
            // Initialize grids
            createGrids();
            createShipSelection();
            
            console.log("Game initialized!");
        }

        // Create game grids
        function createGrids() {
            const playerGrid = document.getElementById('playerGrid');
            const attackGrid = document.getElementById('attackGrid');
            
            // Clear grids
            playerGrid.innerHTML = '';
            attackGrid.innerHTML = '';
            
            // Create player grid (10x10)
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // Add click event for ship placement
                    cell.addEventListener('click', () => {
                        if (gameState.gamePhase === "placement" && gameState.selectedShip !== null) {
                            placeShip(row, col);
                        } else if (gameState.gamePhase === "battle" && gameState.currentTurn === gameState.playerNumber) {
                            makeAttack(row, col);
                        }
                    });
                    
                    // Add hover effects
                    cell.addEventListener('mouseenter', () => {
                        if (gameState.gamePhase === "placement" && gameState.selectedShip !== null) {
                            showPlacementPreview(row, col);
                        }
                    });
                    
                    cell.addEventListener('mouseleave', () => {
                        if (gameState.gamePhase === "placement") {
                            clearPlacementPreview();
                        }
                    });
                    
                    playerGrid.appendChild(cell);
                }
            }
            
            // Create attack grid
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    cell.addEventListener('click', () => {
                        if (gameState.gamePhase === "battle" && gameState.currentTurn === gameState.playerNumber) {
                            makeAttack(row, col);
                        }
                    });
                    
                    attackGrid.appendChild(cell);
                }
            }
            
            // Initially disable attack grid
            updateAttackGrid();
        }

        // Create ship selection panel
        function createShipSelection() {
            const shipSelection = document.getElementById('shipSelection');
            shipSelection.innerHTML = '';
            
            gameState.shipTypes.forEach((ship, index) => {
                const shipElement = document.createElement('div');
                shipElement.className = 'ship-item';
                if (ship.placed) shipElement.classList.add('placed');
                shipElement.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 5px;">${getShipIcon(ship.size)}</div>
                    <div style="font-weight: bold;">${ship.name}</div>
                    <div style="font-size: 0.9rem;">Size: ${ship.size}</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; color: ${ship.placed ? '#00E676' : '#4FC3F7'}">
                        ${ship.placed ? '‚úì Placed' : 'Click to select'}
                    </div>
                `;
                
                // Add click event
                shipElement.addEventListener('click', () => {
                    if (!ship.placed) {
                        selectShip(index);
                    }
                });
                
                shipSelection.appendChild(shipElement);
            });
            
            // Select first available ship
            const firstAvailable = gameState.shipTypes.findIndex(ship => !ship.placed);
            if (firstAvailable !== -1) {
                selectShip(firstAvailable);
            }
        }

        function getShipIcon(size) {
            const icons = {
                5: 'üö¢', // Carrier
                4: 'üõ≥Ô∏è', // Battleship
                3: '‚õ¥Ô∏è', // Cruiser/Submarine
                2: 'üö§'  // Destroyer
            };
            return icons[size] || 'üö¢';
        }

        // Select a ship
        function selectShip(index) {
            gameState.selectedShip = index;
            
            // Update UI
            document.querySelectorAll('.ship-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            // Update instructions
            const ship = gameState.shipTypes[index];
            document.getElementById('shipStatusTitle').textContent = `SELECTED: ${ship.name} (Size: ${ship.size})`;
            
            console.log(`Selected ship: ${ship.name}`);
        }

        // Show placement preview
        function showPlacementPreview(row, col) {
            clearPlacementPreview();
            
            if (gameState.selectedShip === null) return;
            
            const ship = gameState.shipTypes[gameState.selectedShip];
            const playerGrid = document.getElementById('playerGrid');
            
            let canPlace = true;
            const previewCells = [];
            
            for (let i = 0; i < ship.size; i++) {
                let cellRow = row;
                let cellCol = col;
                
                if (gameState.orientation === "vertical") {
                    cellRow = row + i;
                } else {
                    cellCol = col + i;
                }
                
                // Check bounds
                if (cellRow >= 10 || cellCol >= 10) {
                    canPlace = false;
                    break;
                }
                
                const cellIndex = cellRow * 10 + cellCol;
                const cell = playerGrid.children[cellIndex];
                
                if (cell) {
                    // Check if cell already has a ship
                    if (cell.classList.contains('ship')) {
                        canPlace = false;
                    }
                    
                    previewCells.push(cell);
                }
            }
            
            // Highlight preview cells
            previewCells.forEach(cell => {
                if (canPlace) {
                    cell.classList.add('placement-hover');
                } else {
                    cell.classList.add('invalid-placement');
                }
            });
            
            // Store for cleanup
            window.previewCells = previewCells;
        }

        function clearPlacementPreview() {
            if (window.previewCells) {
                window.previewCells.forEach(cell => {
                    cell.classList.remove('placement-hover', 'invalid-placement');
                });
                window.previewCells = null;
            }
        }

        // Place a ship
        function placeShip(row, col) {
            if (gameState.selectedShip === null) return;
            
            const ship = gameState.shipTypes[gameState.selectedShip];
            if (ship.placed) return;
            
            const playerGrid = document.getElementById('playerGrid');
            const cells = [];
            
            // Check if placement is valid
            for (let i = 0; i < ship.size; i++) {
                let cellRow = row;
                let cellCol = col;
                
                if (gameState.orientation === "vertical") {
                    cellRow = row + i;
                } else {
                    cellCol = col + i;
                }
                
                // Check bounds
                if (cellRow >= 10 || cellCol >= 10) {
                    addChatMessage("System", `Cannot place ${ship.name} - out of bounds!`);
                    return;
                }
                
                const cellIndex = cellRow * 10 + cellCol;
                const cell = playerGrid.children[cellIndex];
                
                // Check if cell already has a ship
                if (cell && cell.classList.contains('ship')) {
                    addChatMessage("System", `Cannot place ${ship.name} - overlapping another ship!`);
                    return;
                }
                
                cells.push({ cell: cell, row: cellRow, col: cellCol });
            }
            
            // Place the ship
            cells.forEach(cellData => {
                if (cellData.cell) {
                    cellData.cell.classList.add('ship');
                }
            });
            
            // Record ship placement
            gameState.ships.push({
                ...ship,
                cells: cells.map(c => ({ row: c.row, col: c.col })),
                hits: 0,
                sunk: false
            });
            
            // Mark ship as placed
            ship.placed = true;
            gameState.placedShips++;
            
            // Clear preview
            clearPlacementPreview();
            
            // Update UI
            updateTurnIndicator();
            createShipSelection();
            addChatMessage("System", `Placed ${ship.name} at (${row},${col})`);
            
            // Select next available ship
            const nextShipIndex = gameState.shipTypes.findIndex(s => !s.placed);
            if (nextShipIndex !== -1) {
                selectShip(nextShipIndex);
            } else {
                gameState.selectedShip = null;
                document.getElementById('shipStatusTitle').textContent = "ALL SHIPS PLACED!";
            }
            
            // Check if all ships are placed
            if (gameState.placedShips >= 5) {
                addChatMessage("System", "All ships placed! Waiting for opponent...");
                // In a real game, this would trigger a ready state
            }
            
            console.log(`Placed ${ship.name} at (${row},${col})`);
        }

        // Make an attack
        function makeAttack(row, col) {
            if (gameState.gamePhase !== "battle") {
                addChatMessage("System", "Battle hasn't started yet!");
                return;
            }
            
            if (gameState.currentTurn !== gameState.playerNumber) {
                addChatMessage("System", "Not your turn!");
                return;
            }
            
            // Check if already attacked here
            const alreadyAttacked = gameState.attacks.some(attack => 
                attack.row === row && attack.col === col
            );
            
            if (alreadyAttacked) {
                addChatMessage("System", "Already attacked here!");
                return;
            }
            
            // Simulate attack (in real game, this would be against opponent's ships)
            const hit = Math.random() > 0.7; // 30% chance to hit for testing
            
            // Record attack
            gameState.attacks.push({ row, col, hit });
            
            // Update attack grid
            const attackGrid = document.getElementById('attackGrid');
            const cellIndex = row * 10 + col;
            const cell = attackGrid.children[cellIndex];
            
            if (cell) {
                if (hit) {
                    cell.classList.add('hit');
                    addChatMessage("You", `üéØ HIT at (${row},${col})!`);
                } else {
                    cell.classList.add('miss');
                    addChatMessage("You", `üåä MISS at (${row},${col})`);
                }
            }
            
            // Switch turns (for testing)
            gameState.currentTurn = gameState.currentTurn === 1 ? 2 : 1;
            updateTurnIndicator();
            updateAttackGrid();
            
            console.log(`Attack at (${row},${col}): ${hit ? 'HIT' : 'MISS'}`);
        }

        // Auto-place all ships
        function autoPlaceShips() {
            if (gameState.placedShips >= 5) {
                addChatMessage("System", "All ships already placed!");
                return;
            }
            
            addChatMessage("System", "Auto-placing all ships...");
            
            // Clear existing ships
            gameState.ships = [];
            gameState.placedShips = 0;
            gameState.shipTypes.forEach(ship => ship.placed = false);
            
            // Clear grid
            const playerGrid = document.getElementById('playerGrid');
            Array.from(playerGrid.children).forEach(cell => {
                cell.classList.remove('ship');
            });
            
            // Auto-place ships
            const placements = [
                { row: 0, col: 0, vertical: true },   // Carrier
                { row: 0, col: 2, vertical: true },   // Battleship
                { row: 0, col: 4, vertical: true },   // Cruiser
                { row: 0, col: 6, vertical: true },   // Submarine
                { row: 2, col: 8, vertical: false }   // Destroyer
            ];
            
            placements.forEach((placement, index) => {
                if (index < gameState.shipTypes.length) {
                    const ship = gameState.shipTypes[index];
                    
                    // Temporarily set orientation
                    const originalOrientation = gameState.orientation;
                    gameState.orientation = placement.vertical ? "vertical" : "horizontal";
                    
                    // Place the ship
                    const playerGrid = document.getElementById('playerGrid');
                    const cells = [];
                    
                    for (let i = 0; i < ship.size; i++) {
                        let cellRow = placement.row;
                        let cellCol = placement.col;
                        
                        if (gameState.orientation === "vertical") {
                            cellRow = placement.row + i;
                        } else {
                            cellCol = placement.col + i;
                        }
                        
                        const cellIndex = cellRow * 10 + cellCol;
                        const cell = playerGrid.children[cellIndex];
                        
                        if (cell) {
                            cell.classList.add('ship');
                            cells.push({ row: cellRow, col: cellCol });
                        }
                    }
                    
                    // Record ship
                    gameState.ships.push({
                        ...ship,
                        cells: cells,
                        hits: 0,
                        sunk: false
                    });
                    
                    ship.placed = true;
                    gameState.placedShips++;
                    
                    // Restore orientation
                    gameState.orientation = originalOrientation;
                }
            });
            
            // Update UI
            updateTurnIndicator();
            createShipSelection();
            addChatMessage("System", "All ships auto-placed!");
            
            // Clear selected ship
            gameState.selectedShip = null;
            document.getElementById('shipStatusTitle').textContent = "ALL SHIPS PLACED!";
        }

        // Update turn indicator
        function updateTurnIndicator() {
            const turnIndicator = document.getElementById('turnIndicator');
            
            if (gameState.gamePhase === "placement") {
                turnIndicator.textContent = `PLACE YOUR SHIPS (${gameState.placedShips}/5)`;
                turnIndicator.style.background = 'linear-gradient(45deg, #FF9800, #FF5722)';
            } else if (gameState.currentTurn === gameState.playerNumber) {
                turnIndicator.textContent = "üéØ YOUR TURN - ATTACK!";
                turnIndicator.style.background = 'linear-gradient(45deg, #00E676, #00C853)';
            } else {
                turnIndicator.textContent = "‚è≥ OPPONENT'S TURN";
                turnIndicator.style.background = 'linear-gradient(45deg, #FF3D00, #DD2C00)';
            }
        }

        // Update attack grid state
        function updateAttackGrid() {
            const attackGrid = document.getElementById('attackGrid');
            const cells = attackGrid.children;
            
            for (let i = 0; i < cells.length; i++) {
                const cell = cells[i];
                if (gameState.gamePhase === "battle" && gameState.currentTurn === gameState.playerNumber) {
                    cell.style.cursor = 'pointer';
                    cell.style.opacity = '1';
                } else {
                    cell.style.cursor = 'not-allowed';
                    cell.style.opacity = '0.5';
                }
            }
        }

        // Add chat message
        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            if (sender === "System") {
                messageDiv.classList.add('system');
                messageDiv.innerHTML = `<strong>System:</strong> ${message}`;
            } else if (sender === "You") {
                messageDiv.classList.add('player');
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Frontend functions for matchmaking
        function startQuickMatch() {
            hideError();
            hideOptions();
            showQueueStatus();
            
            // Simulate matchmaking
            setTimeout(() => {
                // Simulate finding opponent
                gameState.opponentName = "Random Opponent";
                showOpponentFound();
            }, 2000);
        }
        
        function generateRoom() {
            hideError();
            hideOptions();
            showRoomStatus();
            
            // Generate random room code
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let roomCode = '';
            for (let i = 0; i < 6; i++) {
                roomCode += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            document.getElementById('roomId').textContent = roomCode;
        }
        
        function joinRoom() {
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            if (!roomCode || roomCode.length !== 6) {
                showError('Please enter a valid 6-character room code');
                return;
            }
            
            hideError();
            hideOptions();
            showQueueStatus();
            
            // Simulate joining room
            setTimeout(() => {
                gameState.opponentName = "Room Opponent";
                showOpponentFound();
            }, 1500);
        }
        
        function copyRoomId() {
            const roomId = document.getElementById('roomId').textContent;
            navigator.clipboard.writeText(roomId).then(() => {
                alert('Room ID copied to clipboard!');
            });
        }
        
        function cancelMatchmaking() {
            resetMatchmakingUI();
        }
        
        function resetMatchmakingUI() {
            hideAllStatuses();
            showOptions();
            hideError();
            document.getElementById('matchmakingStatus').textContent = 'CHOOSE GAME MODE';
            document.getElementById('roomCodeInput').value = '';
        }
        
        // UI Helper Functions
        function hideOptions() {
            document.getElementById('matchmakingOptions').classList.add('hidden');
            const cancelBtn = document.getElementById('cancelBtn');
            if (cancelBtn) cancelBtn.classList.remove('hidden');
        }
        
        function showOptions() {
            document.getElementById('matchmakingOptions').classList.remove('hidden');
            const cancelBtn = document.getElementById('cancelBtn');
            if (cancelBtn) cancelBtn.classList.add('hidden');
        }
        
        function showQueueStatus() {
            hideAllStatuses();
            document.getElementById('queueStatus').classList.remove('hidden');
            document.getElementById('searchingDots').classList.remove('hidden');
            document.getElementById('matchmakingStatus').textContent = 'MATCHMAKING';
        }
        
        function showRoomStatus() {
            hideAllStatuses();
            document.getElementById('roomStatus').classList.remove('hidden');
            document.getElementById('matchmakingStatus').textContent = 'ROOM CREATED';
        }
        
        function hideAllStatuses() {
            document.getElementById('queueStatus').classList.add('hidden');
            document.getElementById('roomStatus').classList.add('hidden');
            document.getElementById('foundOpponent').classList.add('hidden');
            document.getElementById('searchingDots').classList.add('hidden');
        }
        
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            
            if (errorElement && errorText) {
                errorText.textContent = message;
                errorElement.style.display = 'block';
                
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 5000);
            }
        }
        
        function hideError() {
            const errorElement = document.getElementById('errorMessage');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }
        
        function showOpponentFound() {
            hideAllStatuses();
            document.getElementById('foundOpponent').classList.remove('hidden');
            document.getElementById('opponentNameDisplay').textContent = gameState.opponentName;
            
            // Start countdown
            let countdown = 3;
            const countdownEl = document.getElementById('countdown');
            countdownEl.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    // Start game
                    startGame();
                } else {
                    countdownEl.textContent = countdown;
                }
            }, 1000);
        }
        
        function startGame() {
            // Hide matchmaking, show game
            document.getElementById('matchmakingScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            // Update opponent name
            document.getElementById('opponentName').textContent = gameState.opponentName;
            
            // Reset game state
            gameState.gamePhase = "placement";
            gameState.currentTurn = 1;
            gameState.placedShips = 0;
            gameState.selectedShip = null;
            gameState.ships = [];
            gameState.attacks = [];
            gameState.shipTypes.forEach(ship => ship.placed = false);
            
            // Re-initialize game
            createGrids();
            createShipSelection();
            updateTurnIndicator();
            
            addChatMessage("System", "Game started! Place your ships.");
        }
        
        // Game functions
        function exitToMenu() {
            if (confirm('Return to main menu?')) {
                window.location.href = '../index.html';
            }
        }
        
        function surrenderGame() {
            if (confirm('Are you sure you want to surrender?')) {
                showGameOver("You surrendered!", false);
            }
        }
        
        function exitGame() {
            if (confirm('Exit this game?')) {
                window.location.href = '../index.html';
            }
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message) {
                addChatMessage("You", message);
                input.value = '';
                input.focus();
            }
        }
        
        function toggleOrientation() {
            gameState.orientation = gameState.orientation === 'vertical' ? 'horizontal' : 'vertical';
            document.getElementById('orientationBtn').textContent = 
                gameState.orientation === 'vertical' ? 'üîÑ VERTICAL' : 'üîÑ HORIZONTAL';
        }
        
        function rematch() {
            document.getElementById('gameOverOverlay').classList.add('hidden');
            resetMatchmakingUI();
            document.getElementById('matchmakingScreen').style.display = 'flex';
            document.getElementById('gameScreen').style.display = 'none';
        }
        
        function goToMenu() {
            window.location.href = '../index.html';
        }
        
        function showGameOver(message, isWin) {
            const overlay = document.getElementById('gameOverOverlay');
            const title = document.getElementById('gameOverTitle');
            const messageEl = document.getElementById('gameOverMessage');
            
            title.textContent = isWin ? 'üéâ VICTORY! üéâ' : 'üíÄ DEFEAT! üíÄ';
            title.style.color = isWin ? '#00E676' : '#FF3D00';
            messageEl.textContent = message;
            
            overlay.classList.remove('hidden');
        }

        // Handle Enter key in chat
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Initialize when page loads
        window.onload = function() {
            initializeGame();
        };
    </script>
</body>
</html>
